from Standard.Base import all

from  Standard.Table.Internal.Table_Helpers import select_columns

## Group By Key
type Group_By_Key
    type Group_By_Key values

    ## See if two keys are equal
    == : Group_By_Key->Boolean
    == that =
        if that.values.length != this.values.length then False else
            0.up_to this.values.length . all i->(this.values.unsafe_at i == that.values.unsafe_at i)

    ## See if two keys are not equal
    != : Group_By_Key->Boolean
    != that = this==that . not

    ## Compares two keys
    compare_to : Group_By_Key->Ordering
    compare_to that :
        loop i =
            comparison = this.values.unsafe_at i . compare_to (that.values.unsafe_at i)
            if comparison != Ordering.Equal then comparison else
                if i == this.length then Ordering.Equal else
                    @Tail_Call loop (i+1)
        loop 0

## Prototype Group By function
Table.group_by selector columns on_problems warnings=
    key_columns = if selector.is_nothing then [] else
        select_columns internal_columns=this.columns selector=selector reorder=True on_problems=on_problems warnings=warnings


